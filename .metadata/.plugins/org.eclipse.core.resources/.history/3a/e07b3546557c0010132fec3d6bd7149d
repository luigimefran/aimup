<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AIMUP - Perfil</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="shortcut icon" href="/img/LogoAimUp.png" type="image/x-icon">

  <style>
    .profile-pic{width:150px;height:150px;object-fit:cover;border-radius:50%;border:3px solid #198754;}
    body{background-color:#198754;}
    #nomePerfil{margin-top:24px;}
    #imcPerfil{margin-top:6px;}
    .btn-calc{width:auto;}
  </style>
</head>
<body>

  <div th:if="${ok}" class="alert alert-success text-center m-3" th:text="${ok}"></div>
  <div th:if="${erro}" class="alert alert-danger text-center m-3" th:text="${erro}"></div>

  <nav class="navbar navbar-light px-3">
    <div class="container-fluid d-flex justify-content-between align-items-center">
      <a th:href="@{/
      }" class="btn btn-outline-light">Voltar</a>
      <h5 class="mb-0">Perfil</h5>
      <a th:href="@{/logout}" class="btn btn-outline-light">Logout</a>
    </div>
  </nav>

  <div class="container py-5">
    <div class="card text-center p-4">

      <img class="profile-pic mx-auto"
           th:src="${(usuario != null and usuario.fotoPerfil != null and !#strings.isEmpty(usuario.fotoPerfil)) ? usuario.fotoPerfil : '/img/LogoAimUp.png'}"
           alt="Perfil">

      <h4 id="nomePerfil">
        <span class="mb-2" style="opacity:.9;"
              th:text="${(usuario != null and usuario.nome != null and !#strings.isEmpty(usuario.nome)) ? usuario.nome : 'Usuário'}">
          Usuário
        </span>
      </h4>

      <!-- Upload de foto -->
      <form class="mt-3" th:action="@{/perfil/foto}" method="post" enctype="multipart/form-data">
        <input type="file" name="foto" class="form-control mb-2" accept="image/*" required>
        <button class="btn btn-success">Atualizar foto</button>
      </form>

      <!-- (Opcional) Seção IMC que você já tinha -->
      <p id="imcPerfil" class="mb-1 mt-4">
        IMC:
        <strong>
          <span id="imcValor"
                th:text="${(usuario != null and usuario.imc != null) ? #numbers.formatDecimal(usuario.imc,1,2) : '0.00'}">
            0.00
          </span>
        </strong>
      </p>
      <p class="mb-2">
        <small><strong>Status: </strong><span id="statusText">—</span></small>
      </p>

      <div class="mt-2 text-center">
        <a th:href="@{/imc}" class="btn btn-success btn-sm px-3 btn-calc">Calcular IMC</a>
      </div>
    </div>
  </div>

  <script>
    (function () {
      const valEl = document.getElementById('imcValor');
      const statusEl = document.getElementById('statusText');
      if (!valEl || !statusEl) return;

      const imc = parseFloat((valEl.textContent || '0').replace(',', '.'));
      let status = 'Não calculado';
      if (Number.isFinite(imc) && imc > 0) {
        if (imc < 18.5) status = 'Abaixo do peso';
        else if (imc < 24.9) status = 'Peso normal';
        else if (imc < 29.9) status = 'Sobrepeso';
        else if (imc < 39.9) status = 'Obesidade';
        else status = 'Obesidade grave';
      }
      statusEl.textContent = status;
    })();
  </script>

</body>
</html>
